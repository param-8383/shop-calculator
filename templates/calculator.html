<!-- Keep your head section unchanged -->

<body id="body">
  <div class="overlay">
    <div class="card w-100" style="max-width: 900px;">
      <div class="toggle-switches">
        <button class="btn btn-outline-primary" onclick="toggleTheme()">Toggle Theme</button>
        <div>
          <button class="btn btn-outline-success me-2" onclick="translateAllToGujarati()">Gujarati</button>
          <button class="btn btn-outline-secondary" onclick="translateAllToEnglish()">English</button>
        </div>
      </div>

      <div id="main-content">
        <div class="text-center mb-4">
          <h3 class="text-primary">🛒 Shop - Khodiyar Provision Store</h3>
          <p class="text-muted">Easily compute totals for your daily sales</p>
        </div>

        {% if error %}
          <div class="alert alert-danger">{{ error }}</div>
        {% endif %}

        <form method="POST" autocomplete="off">
          <div class="form-section">
            <div class="form-group">
              <label class="form-label">Amul Gold (₹34)</label>
              <input type="number" min="0" name="amul_gold" class="form-control" placeholder="Qty" />
            </div>
            <div class="form-group">
              <label class="form-label">Amul Taaza (₹28)</label>
              <input type="number" min="0" name="amul_taaza" class="form-control" placeholder="Qty" />
            </div>
            <div class="form-group">
              <label class="form-label">Amul Tea (₹63)</label>
              <input type="number" min="0" name="amul_tea" class="form-control" placeholder="Qty" />
            </div>
            <div class="form-group">
              <label class="form-label">Amul Chai Maza (₹55)</label>
              <input type="number" min="0" name="amul_chai_maza" class="form-control" placeholder="Qty" />
            </div>
            <div class="form-group">
              <label class="form-label">Other (₹)</label>
              <input type="number" min="0" name="other" class="form-control" placeholder="Amount" />
            </div>
          </div>
          <button type="submit" class="btn btn-success w-100 mt-3">Calculate Total</button>
        </form>

        {% if details %}
          <hr />
          <h6 class="text-center mt-3">Breakdown</h6>
          <ul class="list-group" id="breakdown-list">
            {% for item, data in details.items() %}
              {% if data.total > 0 %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  {% if data.qty is defined and data.price is defined %}
                    <span class="item-line">{{ item }} — {{ data.qty }} × ₹{{ data.price }}</span>
                  {% else %}
                    <span class="item-line">{{ item }}</span>
                  {% endif %}
                  <strong class="item-total">₹{{ data.total }}</strong>
                </li>
              {% endif %}
            {% endfor %}
          </ul>
          <div class="alert alert-info text-center mt-3 total-box" id="total-box">
            Total: ₹{{ total }}
          </div>
        {% endif %}
      </div>
    </div>
  </div>

  <script>
    function toggleTheme() {
      document.body.classList.toggle('dark-mode');
    }

    const translations = {
      'Amul Gold': 'અમૂલ ગોલ્ડ',
      'Amul Taaza': 'અમૂલ તાઝા',
      'Amul Tea': 'અમૂલ ટી',
      'Amul Chai Maza': 'ચા મજા',
      'Other': 'અન્ય',
      'Qty': 'જથ્થો',
      'Amount': 'રકમ',
      'Calculate Total': 'કુલ ગણો',
      'Breakdown': 'વિગતવાર',
      'Total:': 'કુલ રકમ:',
    };

    const gujDigits = ['૦', '૧', '૨', '૩', '૪', '૫', '૬', '૭', '૮', '૯'];
    const engDigits = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'];

    function toGujaratiDigit(str) {
      return str.toString().split('').map(d => gujDigits[parseInt(d)] ?? d).join('');
    }

    function toEnglishDigit(str) {
      return str.split('').map(d => {
        const index = gujDigits.indexOf(d);
        return index !== -1 ? index : d;
      }).join('');
    }

    function translateAllToGujarati() {
      document.getElementById('main-content').classList.add('gujarati-font');

      document.querySelectorAll('.form-label').forEach(label => {
        for (let en in translations) {
          if (label.textContent.includes(en)) {
            label.textContent = label.textContent
              .replace(en, translations[en])
              .replace(/\d+/g, m => toGujaratiDigit(m));
          }
        }
      });

      document.querySelectorAll('.form-control').forEach(input => {
        if (input.placeholder === 'Qty') input.placeholder = translations['Qty'];
        if (input.placeholder === 'Amount') input.placeholder = translations['Amount'];
      });

      const button = document.querySelector('.btn-success');
      if (button) button.textContent = translations['Calculate Total'];

      const breakdown = document.querySelector('h6');
      if (breakdown) breakdown.textContent = translations['Breakdown'];

      const totalBox = document.getElementById('total-box');
      if (totalBox) {
        totalBox.innerHTML = totalBox.innerHTML
          .replace('Total:', translations['Total:'])
          .replace(/\d+/g, m => toGujaratiDigit(m));
      }

      document.querySelectorAll('.item-line').forEach(el => {
        el.innerHTML = el.innerHTML.replace(/\d+/g, m => toGujaratiDigit(m));
      });

      document.querySelectorAll('.item-total').forEach(el => {
        el.textContent = el.textContent.replace(/\d+/g, m => toGujaratiDigit(m));
      });
    }

    function translateAllToEnglish() {
      document.getElementById('main-content').classList.remove('gujarati-font');

      const reverseMap = Object.fromEntries(Object.entries(translations).map(([k, v]) => [v, k]));

      document.querySelectorAll('.form-label').forEach(label => {
        for (let guj in reverseMap) {
          if (label.textContent.includes(guj)) {
            label.textContent = label.textContent
              .replace(guj, reverseMap[guj])
              .replace(/[૦૧૨૩૪૫૬૭૮૯]+/g, m => toEnglishDigit(m));
          }
        }
      });

      document.querySelectorAll('.form-control').forEach(input => {
        if (input.placeholder === translations['Qty']) input.placeholder = 'Qty';
        if (input.placeholder === translations['Amount']) input.placeholder = 'Amount';
      });

      const button = document.querySelector('.btn-success');
      if (button) button.textContent = 'Calculate Total';

      const breakdown = document.querySelector('h6');
      if (breakdown) breakdown.textContent = 'Breakdown';

      const totalBox = document.getElementById('total-box');
      if (totalBox) {
        totalBox.innerHTML = totalBox.innerHTML
          .replace(translations['Total:'], 'Total:')
          .replace(/[૦૧૨૩૪૫૬૭૮૯]+/g, m => toEnglishDigit(m));
      }

      document.querySelectorAll('.item-line').forEach(el => {
        el.innerHTML = el.innerHTML.replace(/[૦૧૨૩૪૫૬૭૮૯]+/g, m => toEnglishDigit(m));
      });

      document.querySelectorAll('.item-total').forEach(el => {
        el.textContent = el.textContent.replace(/[૦૧૨૩૪૫૬૭૮૯]+/g, m => toEnglishDigit(m));
      });
    }
  </script>
</body>
